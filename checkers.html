<html><head>
<style>

body {
	margin: 0px;
	border: 0;
	overflow: hidden;
	display: block;
	position: relative;
}

#board {
	position: absolute;
	left: 0;
	top: 0;
	width: 384px;
	height: 384px;
	background-image: url("board.png");
	image-rendering: pixelated;
	background-size: cover;
}

#fields {
	position: absolute;
	left: 0;
	top: 0;
	width: 384px;
	height: 384px;
}

#highlight {
	position: absolute;
	width: 48px;
	height: 48px;
	background-color: #ffffff;
	mix-blend-mode: screen;
	opacity: 0.6;
	visibility: hidden;
}

.asset {
	visibility: hidden;
}

#overlay {
	position: absolute;
	left: 0;
	top: 0;
	width: 384px;
	height: 384px;
}	

</style>
<script type="text/javascript">

var input = {
	modes: { DISABLE: 0, FROM: 1, TO: 2 },
	mode: 1,
	from: { x: 0, y: 0 },
	to: { x:0, y: 0 }
};


var X = 99;
var E = 0;
var W = 1;
var WQ = 2;
var B = -1;
var BQ = -2;

function foe_of(player) {
	if(player == B) return W;
	if(player == W) return B;
	console.log(foe_of.name + ": invalid player");
};

function belongs_to(field) {
	if((field == B) || (field == BQ)) return B;
	if((field == W) || (field == WQ)) return W;
	return E;
};
	
function direction(player) {
	if(player == W) return -1;
	if(player == B) return 1;
	console.log(direction.name + ": invalid player");
};

function is_queen(field) {
	if((field == BQ) || (field == WQ)) return true;
	else return false;
	
	
};

var game = {
	
	fields: undefined,

	init: function() {
	
		game.fields = [
			[ X, B, X, B, X, B, X, B ],
			[ B, X, B, X, B, X, B, X ],
			[ X, B, X, B, X, B, X, B ],
			[ E, X, E, X, E, X, E, X ],
			[ X, E, X, E, X, E, X, E ],
			[ W, X, W, X, W, X, W, X ],
			[ X, W, X, W, X, W, X, W ],
			[ W, X, W, X, W, X, W, X ]
			];
	},
	
	/* test if a hop is possible */
	is_valid_hop: function(hop, player) {
		
		var q = false;
		
		/* check if move does not fall off the board */
		function _limits(v) {
			if(v < 0 || v > 7) return false;
			else return true;
		};
		
		if(!_limits(hop.from.x)) return false;
		if(!_limits(hop.from.y)) return false;
		if(!_limits(hop.to.x)) return false;
		if(!_limits(hop.to.y)) return false;
		
		/* check if right player */
		if(belongs_to(this.fields[hop.from.y][hop.from.x]) != player) return false;
		if(is_queen(this.fields[hop.from.y][hop.from.x])) q = true;
		
		/* check if we have space to move */
		if(this.fields[hop.to.y][hop.to.x] != E) return false;
		
		/* check move type */
		function _distance(hop) {
			var xd = Math.abs(hop.from.x - hop.to.x);
			var yd = Math.abs(hop.from.y - hop.to.y);
			if(xd == yd) return xd;
			else return false;
		};
		
		var d = _distance(hop);
		if(!q) {
			if(d == 1) {
				/* can only move forward */
				if(hop.to.y - hop.from.y == direction(player)) return true;
				else return false;
			} else
			if(d == 2) {
				if(
					this.fields
						[(hop.to.y + hop.from.y) / 2]
						[(hop.to.x + hop.from.x) / 2] 
					== -player
				)
				return true;		/* hit */
				else return false;	/* no hit */
				
			} else 
			return false;	/* moving to far */
		} else { /* queen */
			
			
			
		};
	},
	
	is_valid_move(move) {
		
		
		
	},
		
	draw_fields: function() {
		var w_checker_img = document.getElementById("w_checker");
		var w_queen_img = document.getElementById("w_queen");
		var b_checker_img = document.getElementById("b_checker");
		var b_queen_img = document.getElementById("b_queen");
		var canv = document.getElementById("fields");
		var ctx = canv.getContext("2d");

		for(var y = 0; y < 8; y++) {
			for(var x = 0; x < 8; x++) {
				switch(this.fields[y][x]) {
					case W:
						ctx.drawImage(w_checker_img, x * 48, y * 48, 48,48);
						break;
					case WQ:
						ctx.drawImage(w_queen_img, x * 48, y * 48, 48,48);		
						break;
					case B:
						ctx.drawImage(b_checker_img, x * 48, y * 48, 48,48);
						break;
					case BQ:
						ctx.drawImage(b_queen_img, x * 48, y * 48, 48,48);		
						break;
						
					default:
				};				
			};
		};
			
			

		this.fields
		
		
	
	}
		
};

function click(ev) {
	
	var x, y;
	var highlight = document.getElementById("highlight");
	x = Math.floor(ev.clientX / 48);
	y = Math.floor(ev.clientY / 48);
	console.log(x + " " + y);

	if(input.mode == input.modes.FROM) {
		if(belongs_to(game.fields[y][x]) == W) {
			input.from = { x: x, y: y };
			input.mode = input.modes.TO;
			highlight.style.left = x * 48;
			highlight.style.top = y * 48;
			highlight.style.visibility = "visible";
			
		};
		
	} else if(input.mode == input.modes.TO) {
		
			highlight.style.visibility = "hidden";
			input.to = { x: x, y: y };
			input.mode = input.modes.FROM;
	};
	
};



function init() {
	var e_overlay = document.getElementById("overlay");
	e_overlay.addEventListener("click", click);
	
	game.init();
	game.draw_fields();
};





</script>
</head><body onload="init()">

<div id="board"></div>
<canvas id="fields" width="384" height="384"></canvas>

<div id="highlight"></div>

<img id="b_checker" class="asset" src="black_checker.png">
<img id="b_queen" class="asset" src="black_queen.png">
<img id="w_checker" class="asset" src="checker.png">
<img id="w_queen" class="asset" src="queen.png">

<div id="overlay"></div>
</body></html>
